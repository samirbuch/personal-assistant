"use strict";(globalThis.webpackChunkpersonal_assistant_docs=globalThis.webpackChunkpersonal_assistant_docs||[]).push([[7454],{28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>a});var s=i(96540);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}},78066:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"generated/CONFERENCE_FEATURE","title":"Conference Call Feature","description":"This document describes the conference call feature that allows you (the owner) to be added into an ongoing call between your AI assistant and a caller.","source":"@site/docs/generated/CONFERENCE_FEATURE.md","sourceDirName":"generated","slug":"/generated/CONFERENCE_FEATURE","permalink":"/personal-assistant/docs/generated/CONFERENCE_FEATURE","draft":false,"unlisted":false,"editUrl":"https://github.com/samirbuch/personal-assistant/edit/main/docs/docs/generated/CONFERENCE_FEATURE.md","tags":[],"version":"current","lastUpdatedBy":"bdotsamir","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Conference Call Architecture - Final Clean Implementation","permalink":"/personal-assistant/docs/generated/CONFERENCE_ARCHITECTURE"},"next":{"title":"Conference Call Quick Start","permalink":"/personal-assistant/docs/generated/CONFERENCE_QUICK_START"}}');var r=i(74848),l=i(28453);const t={},a="Conference Call Feature",c={},o=[{value:"Overview",id:"overview",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"1. <strong>Transfer Initiation</strong>",id:"1-transfer-initiation",level:3},{value:"2. <strong>Conference Creation</strong>",id:"2-conference-creation",level:3},{value:"3. <strong>Speaker Diarization</strong>",id:"3-speaker-diarization",level:3},{value:"4. <strong>Smart Response Gating</strong>",id:"4-smart-response-gating",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Example Usage",id:"example-usage",level:3},{value:"Architecture",id:"architecture",level:2},{value:"New Components",id:"new-components",level:3},{value:"API Endpoints",id:"api-endpoints",level:3},{value:"Create Conference",id:"create-conference",level:4},{value:"Conference Status Callback",id:"conference-status-callback",level:4},{value:"Technical Details",id:"technical-details",level:2},{value:"Stream Reconnection (The Key Insight)",id:"stream-reconnection-the-key-insight",level:3},{value:"Speaker Diarization",id:"speaker-diarization",level:3},{value:"State Management",id:"state-management",level:3},{value:"Response Decision Flow",id:"response-decision-flow",level:3},{value:"Testing",id:"testing",level:2},{value:"Manual Test Procedure",id:"manual-test-procedure",level:3},{value:"Debugging",id:"debugging",level:3},{value:"Limitations &amp; Future Improvements",id:"limitations--future-improvements",level:2},{value:"Current Limitations",id:"current-limitations",level:3},{value:"Future Improvements",id:"future-improvements",level:3},{value:"Cost Considerations",id:"cost-considerations",level:2},{value:"Security",id:"security",level:2},{value:"Support",id:"support",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"conference-call-feature",children:"Conference Call Feature"})}),"\n",(0,r.jsx)(n.p,{children:"This document describes the conference call feature that allows you (the owner) to be added into an ongoing call between your AI assistant and a caller."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"When a caller requests to speak with a human or when the AI determines it needs human assistance, it can initiate a 3-way conference call. This seamlessly brings you into the ongoing conversation while maintaining the same call session."}),"\n",(0,r.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsxs)(n.h3,{id:"1-transfer-initiation",children:["1. ",(0,r.jsx)(n.strong,{children:"Transfer Initiation"})]}),"\n",(0,r.jsxs)(n.p,{children:["The AI assistant uses the ",(0,r.jsx)(n.code,{children:"transferToHuman"})," tool when:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The caller explicitly asks to speak with a human"}),"\n",(0,r.jsx)(n.li,{children:"The caller asks to speak with you (Samir) directly"}),"\n",(0,r.jsx)(n.li,{children:"The situation is too complex for the AI to handle alone"}),"\n",(0,r.jsx)(n.li,{children:"You can also manually trigger this via the API"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"2-conference-creation",children:["2. ",(0,r.jsx)(n.strong,{children:"Conference Creation"})]}),"\n",(0,r.jsx)(n.p,{children:"When transfer is initiated:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"A Twilio conference is created"}),"\n",(0,r.jsxs)(n.li,{children:["You receive a call on your phone (configured via ",(0,r.jsx)(n.code,{children:"OWNER_PHONE_NUMBER"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"The original caller's call is moved to the conference"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stream Reconnection"})," (expected behavior):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The media stream disconnects and reconnects (~1-2 seconds)"}),"\n",(0,r.jsx)(n.li,{children:"New STT/TTS connections are created"}),"\n",(0,r.jsx)(n.li,{children:"All conversation history and state are preserved"}),"\n",(0,r.jsx)(n.li,{children:"The reconnection is detected automatically and handled gracefully"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"The AI assistant remains in the call but becomes more selective about when to speak"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"3-speaker-diarization",children:["3. ",(0,r.jsx)(n.strong,{children:"Speaker Diarization"})]}),"\n",(0,r.jsxs)(n.p,{children:["Speaker diarization is ",(0,r.jsx)(n.strong,{children:"always enabled"})," from the start of every call:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Minimal performance overhead"}),"\n",(0,r.jsx)(n.li,{children:"No need to reconnect when entering conference mode"}),"\n",(0,r.jsx)(n.li,{children:"Once in conference, the system distinguishes between you and the caller"}),"\n",(0,r.jsx)(n.li,{children:"Transcripts are tagged with speaker labels (CALLER vs OWNER)"}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"4-smart-response-gating",children:["4. ",(0,r.jsx)(n.strong,{children:"Smart Response Gating"})]}),"\n",(0,r.jsx)(n.p,{children:"A secondary AI agent (ResponseGatekeeper) analyzes each utterance to determine if the main assistant should respond:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Responds when"}),": You or the caller directly address the assistant, ask it questions, or request it to perform tasks"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stays silent when"}),": You and the caller are having a human-to-human conversation"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsxs)(n.p,{children:["Add this to your ",(0,r.jsx)(n.code,{children:".env"})," file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Owner's phone number for conference calls\n# Format: E.164 format (e.g., +12676253752)\nOWNER_PHONE_NUMBER=+1XXXXXXXXXX\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-usage",children:"Example Usage"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scenario 1: Caller Requests Human"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Caller: "Can I speak with a real person?"\nAI: "Of course! Let me connect you with Samir. One moment please."\n[AI uses transferToHuman tool]\n[Conference call is created]\n[You receive a call and join]\nAI: "Hi Samir, I\'ve connected you with the caller."\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scenario 2: During Conference"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'You: "Hey there! How can I help you today?"\nCaller: "Hi! I was trying to book an appointment..."\nYou: "Jordan, can you check my calendar for next week?"\nAI: "Sure! I\'ll check your availability for next week..."\n[AI responds because directly addressed]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(n.h3,{id:"new-components",children:"New Components"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"ConferenceManager"})," (",(0,r.jsx)(n.code,{children:"src/managers/ConferenceManager.ts"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Manages Twilio conference creation"}),"\n",(0,r.jsx)(n.li,{children:"Tracks conference state"}),"\n",(0,r.jsx)(n.li,{children:"Handles adding participants"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"ResponseGatekeeper"})," (",(0,r.jsx)(n.code,{children:"src/managers/ResponseGatekeeper.ts"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"AI agent that decides when to respond in conference mode"}),"\n",(0,r.jsx)(n.li,{children:"Uses Claude to analyze conversation context"}),"\n",(0,r.jsx)(n.li,{children:"Returns confidence scores with decisions"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Enhanced ConversationManager"})," (",(0,r.jsx)(n.code,{children:"src/core/ConversationManager.ts"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Tracks speaker identities (CALLER, OWNER, ASSISTANT)"}),"\n",(0,r.jsx)(n.li,{children:"Formats messages with speaker labels for LLM context"}),"\n",(0,r.jsx)(n.li,{children:"Manages multi-speaker conversation history"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Conference Mode in VoiceAgent"})," (",(0,r.jsx)(n.code,{children:"src/core/VoiceAgent.ts"}),")"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enables/disables conference mode"}),"\n",(0,r.jsx)(n.li,{children:"Integrates with ResponseGatekeeper"}),"\n",(0,r.jsx)(n.li,{children:"Handles diarized transcripts"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,r.jsx)(n.h4,{id:"create-conference",children:"Create Conference"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'POST /api/create-conference/:streamSid\nBody: { "reason": "Caller requested human assistance" }\n'})}),"\n",(0,r.jsx)(n.h4,{id:"conference-status-callback",children:"Conference Status Callback"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"POST /api/conference-status\n"})}),"\n",(0,r.jsx)(n.p,{children:"Receives webhooks from Twilio about conference events (participant join/leave)."}),"\n",(0,r.jsx)(n.h2,{id:"technical-details",children:"Technical Details"}),"\n",(0,r.jsx)(n.h3,{id:"stream-reconnection-the-key-insight",children:"Stream Reconnection (The Key Insight)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Why does the stream reconnect?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Twilio media streams are attached to a specific call's TwiML"}),"\n",(0,r.jsx)(n.li,{children:"When we move a call to a conference, we update its TwiML"}),"\n",(0,r.jsx)(n.li,{children:"This causes Twilio to disconnect and reconnect the media stream"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"This is expected Twilio behavior, not a bug"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"How we handle it gracefully:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:'TwilioHandler detects the reconnection (new "start" message with existing streamSid)'}),"\n",(0,r.jsx)(n.li,{children:"Creates new STT/TTS connections"}),"\n",(0,r.jsx)(n.li,{children:"Updates the existing VoiceAgent's connections"}),"\n",(0,r.jsx)(n.li,{children:"Preserves all state: conversation history, conference mode flag, speaker mappings"}),"\n",(0,r.jsx)(n.li,{children:"Total interruption: ~1-2 seconds"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What's preserved during reconnection:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Full conversation history"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Conference mode flag"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Speaker identification (caller vs owner)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Agent state"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 All LLM context"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"speaker-diarization",children:"Speaker Diarization"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enabled automatically from the start of every call (no performance impact)"}),"\n",(0,r.jsxs)(n.li,{children:["Uses Deepgram's ",(0,r.jsx)(n.code,{children:"diarize: true"})," option"]}),"\n",(0,r.jsx)(n.li,{children:"Each transcript includes a speaker ID (0, 1, 2, etc.)"}),"\n",(0,r.jsx)(n.li,{children:"System learns which speaker ID corresponds to caller vs owner during conference"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"state-management",children:"State Management"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Conference mode is a flag on the VoiceAgent"}),"\n",(0,r.jsx)(n.li,{children:"ConversationManager maintains speaker mappings"}),"\n",(0,r.jsx)(n.li,{children:"First speaker in call is assumed to be caller"}),"\n",(0,r.jsx)(n.li,{children:"Second speaker is assumed to be owner"}),"\n",(0,r.jsx)(n.li,{children:"When stream reconnects (during conference setup), existing session is detected and preserved"}),"\n",(0,r.jsx)(n.li,{children:"STT/TTS connections are gracefully replaced without losing conversation history"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"response-decision-flow",children:"Response Decision Flow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"1. Transcript received with speaker ID\n2. Add to conversation with speaker label\n3. If in conference mode:\n   a. Get last speaker (CALLER or OWNER)\n   b. Call ResponseGatekeeper.shouldAssistantRespond()\n   c. If shouldRespond = false: Stay silent\n   d. If shouldRespond = true: Generate and speak response\n"})}),"\n",(0,r.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,r.jsx)(n.h3,{id:"manual-test-procedure",children:"Manual Test Procedure"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Start the server with ",(0,r.jsx)(n.code,{children:"OWNER_PHONE_NUMBER"})," configured"]}),"\n",(0,r.jsx)(n.li,{children:"Initiate a call to your assistant"}),"\n",(0,r.jsx)(n.li,{children:'During the call, say: "I\'d like to speak with a human"'}),"\n",(0,r.jsx)(n.li,{children:"You should receive a call on your configured phone"}),"\n",(0,r.jsx)(n.li,{children:"Answer the call and verify you're in a 3-way conference"}),"\n",(0,r.jsxs)(n.li,{children:["Test the following scenarios:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Talk directly to the caller (AI should stay silent)"}),"\n",(0,r.jsx)(n.li,{children:"Ask the AI a question (AI should respond)"}),"\n",(0,r.jsx)(n.li,{children:"Ask the caller something (AI should stay silent)"}),"\n",(0,r.jsx)(n.li,{children:"Ask the AI to check the calendar (AI should respond)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"debugging",children:"Debugging"}),"\n",(0,r.jsx)(n.p,{children:"Enable verbose logging by checking console output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'[Conference] Creating conference: conf-MZ...\n[STT MZ...] Connected (Diarization enabled)\n[STT MZ...] Transcript: speaker=0, text="..."\n[Conversation] Caller identified as Speaker 0\n[Gatekeeper] Decision: SILENT (confidence: 0.9) - Humans talking to each other\n'})}),"\n",(0,r.jsx)(n.h2,{id:"limitations--future-improvements",children:"Limitations & Future Improvements"}),"\n",(0,r.jsx)(n.h3,{id:"current-limitations",children:"Current Limitations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Owner phone number must be configured in advance (single owner)"}),"\n",(0,r.jsx)(n.li,{children:"Conference billing rates apply from Twilio"}),"\n",(0,r.jsx)(n.li,{children:"Diarization is always enabled (minimal overhead)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"future-improvements",children:"Future Improvements"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Multiple owner support"}),"\n",(0,r.jsx)(n.li,{children:"Analytics on conference usage"}),"\n",(0,r.jsx)(n.li,{children:"Recording conferences for quality assurance"}),"\n",(0,r.jsx)(n.li,{children:"WebRTC-based owner connection (no phone call needed)"}),"\n",(0,r.jsx)(n.li,{children:"Dynamic diarization toggling (currently always on)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"cost-considerations",children:"Cost Considerations"}),"\n",(0,r.jsx)(n.p,{children:"Conference calls incur additional Twilio charges:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Conference hosting: ~$0.0025/minute/participant"}),"\n",(0,r.jsx)(n.li,{children:"Additional phone call to owner: Standard rates apply"}),"\n",(0,r.jsx)(n.li,{children:"Deepgram diarization: Included in standard rates"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"security",children:"Security"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Only configured owner phone can be added to conference"}),"\n",(0,r.jsx)(n.li,{children:"Conference names are unique per stream (unpredictable)"}),"\n",(0,r.jsx)(n.li,{children:"Status callbacks can be secured with webhook authentication (not yet implemented)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"support",children:"Support"}),"\n",(0,r.jsx)(n.p,{children:"For issues or questions about this feature:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Check server logs for detailed trace"}),"\n",(0,r.jsxs)(n.li,{children:["Verify ",(0,r.jsx)(n.code,{children:"OWNER_PHONE_NUMBER"})," is in correct format"]}),"\n",(0,r.jsx)(n.li,{children:"Ensure Twilio account has conference calling enabled"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);